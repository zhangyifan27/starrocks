-- name: test_ttest_1samp

drop database if exists ttest_1samp_test_db;
-- result:
-- !result
create database ttest_1samp_test_db;
-- result:
-- !result
use ttest_1samp_test_db;
-- result:
-- !result
drop table if exists ttest_1samp_test_tbl;
-- result:
-- !result
create table ttest_1samp_test_tbl
(
    `treatment` boolean,
    `numerator` double,
    `denominator` boolean,
    `numerator_pre` bigint,
    `denominator_pre` boolean,
    `Y` double,
    `X1` int,
    `X2` int,
    `X3` int,
    `X3_string` string,
    `X7_needcut` bigint,
    `X8_needcut` bigint,
    `weight` double,
    `distance` double
)
properties (
    "replication_num"="1"
);
-- result:
-- !result
shell: curl --location-trusted -u root: -T ${root_path}/lib/../common/data/stream_load/all_in_sql_test.csv -XPUT -H column_separator:, ${url}/api/ttest_1samp_test_db/ttest_1samp_test_tbl/_stream_load
-- result:
-- !result
sync;
-- result:
-- !result

select count(*), floor(sum(`numerator`)), floor(sum(`Y`)) from ttest_1samp_test_tbl;
-- result:
[REGEX]793200\s646026213\s323166914
-- !result


select ttest_1samp('x1/x2', 'less', 0, [numerator, denominator]) from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 814.4556396877363, "lower": "-inf", "p-value": 1, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 35.15462409884406, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n814.455640  35.154624   23.167810   1.000000    -inf        872.279918  \n", "t-statistic": 23.167809657066332, "upper": 872.2799181744489}
-- !result

select ttest_1samp('x1/x2', 'two-sided', 0, [numerator, denominator]) from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 814.4556396877363, "lower": 745.5537374246065, "p-value": 0, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 35.15462409884406, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n814.455640  35.154624   23.167810   0.000000    745.553737  883.357542  \n", "t-statistic": 23.167809657066332, "upper": 883.357541950866}
-- !result

select ttest_1samp('x1/x2', 'two-sided', 1, [numerator, denominator]) from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 813.4556396877363, "lower": 744.5537374246065, "p-value": 0, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 35.15462409884406, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n813.455640  35.154624   23.139364   0.000000    744.553737  882.357542  \n", "t-statistic": 23.139363897066502, "upper": 882.357541950866}
-- !result

select ttest_1samp('x1/x2', 'greater', 1.111, [numerator, denominator]) from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 813.3446396877363, "lower": 755.5203612010237, "p-value": 0, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 35.15462409884406, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n813.344640  35.154624   23.136206   0.000000    755.520361  inf         \n", "t-statistic": 23.13620641770652, "upper": "inf"}
-- !result

select ttest_1samp('x1/x2', 'less', 1.111, [numerator, denominator, X1, X2, X3], 'X=x3/x4+x5') from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 813.3446396877363, "lower": "-inf", "p-value": 1, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 34.87204352689894, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n813.344640  34.872044   23.323687   1.000000    -inf        870.704114  \n", "t-statistic": 23.323687327367374, "upper": 870.7041139529289}
-- !result

select ttest_1samp('x1/x2', 'less', 1.111, [numerator, denominator, X1, X2, X3], 'X=x3/x4+x5', 0.95) from ttest_1samp_test_tbl;
-- result:
[LOOSE]{"causal-function": "ttest_1samp", "estimate": 813.3446396877363, "lower": "-inf", "p-value": 1, "schema": "{\n    causal-function(string),\n    estimate(double),\n    stderr(double),\n    t-statistic(double),\n    p-value(double),\n    lower(double),\n    upper(double),\n    summary(string)\n  }", "stderr": 34.87204352689894, "summary": "\nestimate    stderr      t-statistic p-value     lower       upper       \n813.344640  34.872044   23.323687   1.000000    -inf        755.985165  \n", "t-statistic": 23.323687327367374, "upper": 755.9851654225437}
-- !result
