-- name: test_group_set

drop database if exists group_set_test_db;
-- result:
-- !result
create database group_set_test_db;
-- result:
-- !result
use group_set_test_db;
-- result:
-- !result
drop table if exists group_set_test_tbl;
-- result:
-- !result
create table `group_set_test_tbl`
(
    `treatment` boolean,
    `numerator` double,
    `denominator` boolean,
    `numerator_pre` bigint,
    `denominator_pre` boolean,
    `Y` double,
    `X1` int,
    `X2` int,
    `X3` int,
    `X3_string` string,
    `X7_needcut` bigint,
    `X8_needcut` bigint,
    `weight` double,
    `distance` double,
    `uin` bigint
)
properties (
    "replication_num"="1"
);
-- result:
-- !result
shell: curl --location-trusted -u root: -T ${root_path}/lib/../common/data/stream_load/all_in_sql_test.csv -XPUT  -H column_separator:, ${url}/api/group_set_test_db/group_set_test_tbl/_stream_load
-- result:
-- !result
sync;
-- result:
-- !result
select count(*), floor(sum(`numerator`)), floor(sum(`y`)) from group_set_test_tbl;
-- result:
[LOOSE]793200 646026213       323166914
-- !result
select group_set(numerator, treatment, [X3_string], ['X3_string']) from group_set_test_tbl;
-- result:
[LOOSE][['X3_string', 0, '0', 382444, 16557910, 473877665204], ['X3_string', 0, '1', 111, 1070986, 701448467502], ['X3_string', 0, '2', 37, 425069, 139979920953], ['X3_string', 0, '3', 14181, 315132805, 465041094599613], ['X3_string', 1, '0', 381880, 19323262.60000088, 226295410095.87433], ['X3_string', 1, '1', 145, 318653.7000000001, 12121967481.13], ['X3_string', 1, '2', 36, 309566.79999999993, 16635674453.840002], ['X3_string', 1, '3', 14365, 292887954.2999954, 311467310606529.7]]
-- !result
